<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <title>Failure Detection Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h2>Failure Detection Dashboard</h2>
            <div id="status-indicator" class="status-badge">
                <span id="status-text">WAITING</span>
                <div id="status-tooltip" class="status-tooltip hidden"></div>
            </div>
        </header>

        <div class="main-content" id="main-content">
            <div class="camera-grid" id="camera-grid">

                <!-- CAMERA 1 -->
                <div class="camera-card" id="card-cam1">
                    <div class="cam-header"><h3>Primary Camera</h3></div>

                    <div class="camera-viewport" id="cam1-container">
                        <img id="cam1-img" class="live-feed" alt="">
                        <div class="disabled-overlay" id="cam1-overlay"><span>DISABLED</span></div>
                    </div>
                    
                    <div class="cam-stats" id="cam1-stats">
                        <div class="cam-stats-inner">
                            <div class="cam-stat-row">Detections: <span class="detect-count" id="cam1-detect-count">0</span></div>
                            <div class="cam-stat-row">Failures: <span class="fail-count" id="cam1-fail-count">0</span></div>
                        </div>
                    </div>
                    
                    <div class="cam-controls">
                        <label class="toggle-switch">
                            <input type="checkbox" id="cam1-toggle">
                            <span class="slider"></span>
                            <span class="label-text">Active</span>
                        </label>
                    </div>

                    <div class="mask-tools">
                        <button id="cam1-clear-masks" class="secondary-btn">Clear Masks</button>
                    </div>
                </div>

                <!-- CAMERA 2 -->
                <div class="camera-card" id="card-cam2">
                    <div class="cam-header"><h3>Secondary Camera</h3></div>

                    <div class="camera-viewport" id="cam2-container">
                        <img id="cam2-img" class="live-feed" alt="">
                        <div class="disabled-overlay" id="cam2-overlay"><span>DISABLED</span></div>
                    </div>

                    <div class="cam-stats" id="cam2-stats">
                        <div class="cam-stats-inner">
                            <div class="cam-stat-row">Detections: <span class="detect-count" id="cam2-detect-count">0</span></div>
                            <div class="cam-stat-row">Failures: <span class="fail-count" id="cam2-fail-count">0</span></div>
                        </div>
                    </div>
                    
                    <div class="cam-controls">
                        <label class="toggle-switch">
                            <input type="checkbox" id="cam2-toggle">
                            <span class="slider"></span>
                            <span class="label-text">Active</span>
                        </label>
                    </div>

                    <div class="mask-tools">
                        <button id="cam2-clear-masks" class="secondary-btn">Clear Masks</button>
                    </div>
                </div>

            </div>

            <!-- CENTER MASK INFO -->
            <div id="mask-help-center">
                <p class="help-box">
                    Click and drag on the camera to add mask zones. Right-click a zone to remove it. Click 'Visualize Mask' to show the mask overlay.
                </p>
            </div>

            <!-- HEALTH BAR -->
            <div class="health-section">
                <div class="health-header">
                    <span>
                        Failure Probability:
                        <span id="ssim-val">--%</span>
                        <span id="confidence-trend" class="confidence-trend">‚Üí</span>
                    </span>
                    <span>Retries: <span id="retry-val">0/0</span></span>
                </div>
                <div class="progress-track">
                    <span id="monitoring-label" class="monitoring-label"></span>
                    <div id="confidence-bar" class="progress-fill"></div>
                </div>
            </div>

            <!-- CONTROLS -->
            <div class="controls">
                <div class="controls-left">
                    <button id="mask-toggle-btn" class="secondary-btn">Visualize Mask</button>

                    <button id="force-start-btn" class="primary-btn btn-success">
                        ‚ñ∂ Start Monitoring
                    </button>

                    <button id="open-settings-btn" class="secondary-btn">‚öôÔ∏è Settings</button>
                </div>

                <div class="controls-right">
                    <button id="open-history-btn" class="secondary-btn">History</button>
                    <button id="open-logs-btn" class="secondary-btn">Logs ‚ñæ</button>
                </div>
            </div>

        </div>
    </div>

    <!-- SETTINGS MODAL -->
    <div id="settings-overlay"></div>
    <dialog id="settings-modal">
        <div class="modal-header">
            <h3>Configuration</h3>

            <div class="modal-header-right">
                <div id="settings-unsaved-warning" class="save-status error"></div>
                <button id="close-modal-x" class="icon-btn">√ó</button>
            </div>
        </div>

        <div id="settings-pages">

            <!-- PAGE 1 ‚Äî THEME SETTINGS -->
            <div id="theme-page">
                <div class="modal-body theme-page-body">
                    <div class="page-header">
                        <h4>Dashboard Theme</h4>
                        <span id="theme-unsaved-warning" class="inline-unsaved-warning" style="display: none;">‚ö† Unsaved changes</span>
                    </div>

                    <div class="theme-modal-body">
                        <div class="theme-card" data-theme-choice="dark">
                            <div class="theme-card-title">
                                <input type="radio" name="theme-choice" value="dark" />
                                <span>Dark (Default)</span>
                            </div>
                            <div class="theme-swatch-row">
                                <div class="theme-swatch" style="background: #0d0d0d;"></div>
                                <div class="theme-swatch" style="background: #1b1b1b;"></div>
                                <div class="theme-swatch" style="background: #2196F3;"></div>
                                <div class="theme-swatch" style="background: #ff00ff;"></div>
                                <div class="theme-swatch" style="background: #f5f5f5;"></div>
                                <div class="theme-swatch" style="background: rgba(255,255,255,0.22);"></div>
                            </div>
                        </div>

                        <div class="theme-card" data-theme-choice="light">
                            <div class="theme-card-title">
                                <input type="radio" name="theme-choice" value="light" />
                                <span>Light</span>
                            </div>
                            <div class="theme-swatch-row">
                                <div class="theme-swatch" style="background: #f4f6f9;"></div>
                                <div class="theme-swatch" style="background: #ffffff;"></div>
                                <div class="theme-swatch" style="background: #2563eb;"></div>
                                <div class="theme-swatch" style="background: #a21caf;"></div>
                                <div class="theme-swatch" style="background: #111827;"></div>
                                <div class="theme-swatch" style="background: #9ca3af;"></div>
                            </div>
                        </div>

                        <div class="theme-card" data-theme-choice="midnight">
                            <div class="theme-card-title">
                                <input type="radio" name="theme-choice" value="midnight" />
                                <span>Midnight</span>
                            </div>
                            <div class="theme-swatch-row">
                                <div class="theme-swatch" style="background: #0b0716;"></div>
                                <div class="theme-swatch" style="background: #120b1d;"></div>
                                <div class="theme-swatch" style="background: #8b5cf6;"></div>
                                <div class="theme-swatch" style="background: #a78bfa;"></div>
                                <div class="theme-swatch" style="background: #f6f0fb;"></div>
                                <div class="theme-swatch" style="background: #bfaed1;"></div>
                            </div>
                        </div>

                        <div class="theme-card" data-theme-choice="crimson">
                            <div class="theme-card-title">
                                <input type="radio" name="theme-choice" value="crimson" />
                                <span>Crimson</span>
                            </div>
                            <div class="theme-swatch-row">
                                <div class="theme-swatch" style="background: #3a0f0a;"></div>
                                <div class="theme-swatch" style="background: #52150f;"></div>
                                <div class="theme-swatch" style="background: #ff6a00;"></div>
                                <div class="theme-swatch" style="background: #ff7a2a;"></div>
                                <div class="theme-swatch" style="background: #fff6f2;"></div>
                                <div class="theme-swatch" style="background: #e7cfc7;"></div>
                            </div>
                        </div>

                        <div class="theme-card" data-theme-choice="mint">
                            <div class="theme-card-title">
                                <input type="radio" name="theme-choice" value="mint" />
                                <span>Mint</span>
                            </div>
                            <div class="theme-swatch-row">
                                <div class="theme-swatch" style="background: #9dddd3;"></div>
                                <div class="theme-swatch" style="background: #cdf1e7;"></div>
                                <div class="theme-swatch" style="background: #84e1f1;"></div>
                                <div class="theme-swatch" style="background: #2dd4bf;"></div>
                                <div class="theme-swatch" style="background: #03383a;"></div>
                                <div class="theme-swatch" style="background: #bfeee9;"></div>
                            </div>
                        </div>

                        <div class="theme-card" data-theme-choice="forest">
                            <div class="theme-card-title">
                                <input type="radio" name="theme-choice" value="forest" />
                                <span>Forest</span>
                            </div>
                            <div class="theme-swatch-row">
                                <div class="theme-swatch" style="background: #07160b;"></div>
                                <div class="theme-swatch" style="background: #0d2416;"></div>
                                <div class="theme-swatch" style="background: #4b8f4b;"></div>
                                <div class="theme-swatch" style="background: #4fa86f;"></div>
                                <div class="theme-swatch" style="background: #eaf6ea;"></div>
                                <div class="theme-swatch" style="background: rgba(76,93,83,0.20);"></div>
                            </div>
                        </div>

                        <div class="theme-card" data-theme-choice="aurora">
                            <div class="theme-card-title">
                                <input type="radio" name="theme-choice" value="aurora" />
                                <span>Aurora</span>
                            </div>
                            <div class="theme-swatch-row">
                                <div class="theme-swatch" style="background: #02050c;"></div>
                                <div class="theme-swatch" style="background: #0e2430;"></div>
                                <div class="theme-swatch" style="background: #3bc5c5;"></div>
                                <div class="theme-swatch" style="background: #8b7fff;"></div>
                                <div class="theme-swatch" style="background: #e8f4ff;"></div>
                                <div class="theme-swatch" style="background: #3bdb8f;"></div>
                            </div>
                        </div>

                        <div class="theme-card" data-theme-choice="voron">
                            <div class="theme-card-title">
                                <input type="radio" name="theme-choice" value="voron" />
                                <span>Voron</span>
                            </div>
                            <div class="theme-swatch-row">
                                <div class="theme-swatch" style="background: #0b0c10;"></div>
                                <div class="theme-swatch" style="background: #12141c;"></div>
                                <div class="theme-swatch" style="background: #ff2d2d;"></div>
                                <div class="theme-swatch" style="background: #ff2d2d;"></div>
                                <div class="theme-swatch" style="background: #f6f6f6;"></div>
                                <div class="theme-swatch" style="background: #3f4656;"></div>
                            </div>
                        </div>

                        <div class="custom-theme-panel">
                            <div class="theme-card-title">
                                <input type="radio" name="theme-choice" value="custom" />
                                <span>Custom</span>
                                <span style="color: var(--text-muted); font-weight: 500;">(advanced)</span>
                            </div>

                            <div class="custom-sections">
                                <!-- Backgrounds Section -->
                                <div class="custom-section">
                                    <div class="custom-section-header">
                                        <span>Backgrounds</span>
                                        <button type="button" class="section-toggle" data-target="bg-section">‚ñ∂</button>
                                    </div>
                                    <div class="custom-section-body collapsed" id="bg-section">
                                        <div class="custom-field">
                                            <span>Main Background</span>
                                            <input id="custom-bg-main" type="color" value="#0d0d0d" />
                                        </div>
                                        <div class="custom-field">
                                            <span>Card Background</span>
                                            <input id="custom-bg-card" type="color" value="#1b1b1b" />
                                        </div>
                                        <div class="custom-field">
                                            <span>Panel Background</span>
                                            <input id="custom-bg-panel" type="color" value="#1a1a1a" />
                                        </div>
                                        <div class="custom-field">
                                            <span>Elevated Background</span>
                                            <input id="custom-bg-elevated" type="color" value="#181818" />
                                        </div>
                                        <div class="custom-field">
                                            <span>Input Background</span>
                                            <input id="custom-bg-input" type="color" value="#111111" />
                                        </div>
                                    </div>
                                </div>

                                <!-- Text Section -->
                                <div class="custom-section">
                                    <div class="custom-section-header">
                                        <span>Text Colors</span>
                                        <button type="button" class="section-toggle" data-target="text-section">‚ñ∂</button>
                                    </div>
                                    <div class="custom-section-body collapsed" id="text-section">
                                        <div class="custom-field">
                                            <span>Main Text</span>
                                            <input id="custom-text-main" type="color" value="#f5f5f5" />
                                        </div>
                                        <div class="custom-field">
                                            <span>Muted Text</span>
                                            <input id="custom-text-muted" type="color" value="#aaaaaa" />
                                        </div>
                                        <div class="custom-field">
                                            <span>Soft Text</span>
                                            <input id="custom-text-soft" type="color" value="#bbbbbb" />
                                        </div>
                                        <div class="custom-field">
                                            <span>Text (Inverse/on accent)</span>
                                            <input id="custom-text-inverse" type="color" value="#111111" />
                                        </div>
                                        <div class="custom-field">
                                            <span>Primary Button Text</span>
                                            <input id="custom-btn-primary-text" type="color" value="#f5f5f5" />
                                        </div>
                                        <div class="custom-field">
                                            <span>Secondary Button Text</span>
                                            <input id="custom-btn-secondary-text" type="color" value="#f5f5f5" />
                                        </div>
                                    </div>
                                </div>

                                <!-- Accents Section -->
                                <div class="custom-section">
                                    <div class="custom-section-header">
                                        <span>Accent & UI</span>
                                        <button type="button" class="section-toggle" data-target="accent-section">‚ñ∂</button>
                                    </div>
                                    <div class="custom-section-body collapsed" id="accent-section">
                                        <div class="custom-field">
                                            <span>Primary Accent</span>
                                            <input id="custom-accent" type="color" value="#2196F3" />
                                        </div>
                                        <div class="custom-field">
                                            <span>Accent (Soft)</span>
                                            <input id="custom-accent-soft" type="color" value="#64b5f6" />
                                        </div>
                                        <div class="custom-field">
                                            <span>Mask Color</span>
                                            <input id="custom-mask" type="color" value="#ff00ff" />
                                        </div>
                                    </div>
                                </div>

                                <!-- Status Colors Section -->
                                <div class="custom-section">
                                    <div class="custom-section-header">
                                        <span>Status Colors</span>
                                        <button type="button" class="section-toggle" data-target="status-section">‚ñ∂</button>
                                    </div>
                                    <div class="custom-section-body collapsed" id="status-section">
                                        <div class="custom-field">
                                            <span>Success</span>
                                            <input id="custom-success" type="color" value="#43a047" />
                                        </div>
                                        <div class="custom-field">
                                            <span>Warning</span>
                                            <input id="custom-warning" type="color" value="#fbc02d" />
                                        </div>
                                        <div class="custom-field">
                                            <span>Danger</span>
                                            <input id="custom-danger" type="color" value="#e53935" />
                                        </div>
                                    </div>
                                </div>

                                <!-- Borders Section -->
                                <div class="custom-section">
                                    <div class="custom-section-header">
                                        <span>Borders</span>
                                        <button type="button" class="section-toggle" data-target="border-section">‚ñ∂</button>
                                    </div>
                                    <div class="custom-section-body collapsed" id="border-section">
                                        <div class="custom-field">
                                            <span>Subtle Border</span>
                                            <input id="custom-border-subtle" type="color" value="#333333" />
                                        </div>
                                        <div class="custom-field">
                                            <span>Strong Border</span>
                                            <input id="custom-border-strong" type="color" value="#555555" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer theme-footer">
                    <div class="theme-footer-left">
                        <button id="back-theme-btn" class="secondary-btn">Back</button>
                        <button id="preview-theme-btn" class="secondary-btn">üëÅ Preview</button>
                    </div>

                    <div class="theme-footer-right">
                        <div id="theme-save-status" class="save-status" aria-live="polite"></div>
                        <button id="save-theme-btn" class="primary-btn">Save Theme</button>
                    </div>
                </div>
            </div>
            
            <!-- PAGE 2 ‚Äî MAIN SETTINGS -->
            <div id="settings-page">
                <div class="modal-body settings-grid">
                    <div class="page-header">
                        <h4>General Settings</h4>
                        <span id="settings-page-unsaved-warning" class="inline-unsaved-warning" style="display: none;">‚ö† Unsaved changes</span>
                    </div>

                    <!-- CAMERA SETUP -->
                    <div class="setting-group">
                        <h4>Camera Setup</h4>

                        <div class="setting-row">
                            <label>Camera Count:</label>
                            <select id="camera_count">
                                <option value="1">1 Camera</option>
                                <option value="2">2 Cameras</option>
                            </select>
                        </div>

                        <div class="setting-row">
                            <label>Cam 1 URL:</label>
                            <input type="text" id="cam1_url_input">
                        </div>

                        <div class="setting-row">
                            <label>Cam 1 Aspect Ratio:</label>
                            <select id="cam1_aspect_ratio">
                                <option value="16:9">16:9</option>
                                <option value="4:3">4:3</option>
                            </select>
                        </div>

                        <div id="cam2-settings" class="collapsible">
                            <div class="setting-row" id="cam2-settings-row">
                                <label>Cam 2 URL:</label>
                                <input type="text" id="cam2_url_input">
                            </div>

                            <div class="setting-row" id="cam2-aspect-row">
                                <label>Cam 2 Aspect Ratio:</label>
                                <select id="cam2_aspect_ratio">
                                    <option value="16:9">16:9</option>
                                    <option value="4:3">4:3</option>
                                </select>
                            </div>
                        </div>

                        <div class="setting-row">
                            <label>Moonraker URL:</label>
                            <input type="text" id="moonraker_url">
                        </div>
                    </div>

                    <!-- FAILURE RESPONSE -->
                    <div class="setting-group">
                        <h4>Failure Response</h4>

                        <div class="setting-row">
                            <label>Check Interval (ms):</label>
                            <input type="number" id="check_interval" min="100" step="100">
                        </div>

                        <div class="help-tooltip">
                            <span class="help-icon">?</span>
                            <div class="help-tooltip-text">
                                How often printer and camera state are checked. Lower values update faster but use more CPU.
                            </div>
                        </div>

                        <div class="setting-row">
                            <label for="infer_every_n_loops">AI Inference Rate:</label>
                            <select id="infer_every_n_loops">
                                <option value="1">Every frame (max accuracy)</option>
                                <option value="2">Every 2 frames (recommended)</option>
                                <option value="3">Every 3 frames (high performance)</option>
                                <option value="4">Every 4 frames (higher performance)</option>
                            </select>
                        </div>

                        <div class="help-tooltip">
                            <span class="help-icon">?</span>
                            <div class="help-tooltip-text">
                                Runs AI less often to reduce CPU load but will slightly delay detection. "frames" = Check Interval.
                            </div>
                        </div>
                        
                        <div class="setting-row">
                            <label>Max Retries:</label>
                            <input type="number" id="consecutive_failures">
                        </div>

                        <div class="help-tooltip">
                            <span class="help-icon">?</span>
                            <div class="help-tooltip-text">
                                Number of consecutive failures detected before action is taken.
                            </div>
                        </div>

                        <div class="setting-row">
                            <label>Failure Action:</label>
                            <select id="on_failure">
                                <option value="nothing">Warning Only</option>
                                <option value="pause">Pause Print</option>
                                <option value="cancel">Cancel Print</option>
                            </select>
                        </div>
                        
                        <div class="setting-row">
                            <label>Send Mobileraker Notification:</label>

                            <div class="toggle-switch toggle-only">
                                <input type="checkbox" id="notify_mobileraker">
                                <label class="slider" for="notify_mobileraker"></label>
                            </div>
                        </div>

                        <div class="help-tooltip">
                            <span class="help-icon">?</span>
                            <div class="help-tooltip-text">
                                Sends a Mobileraker push notification when a failure is triggered.
                                <br>
                                ‚ö†Ô∏è Requires Mobileraker and MR_NOTIFY macro to be installed/setup.
                            </div>
                        </div>
                        
                    </div>

                    <!-- AI CATEGORY BUTTON CARD -->
                    <div class="setting-group">
                        <h4>AI Categories</h4>
                        <div class="ai-cat-btn-container">
                            <button id="open-ai-cat-btn" class="secondary-btn">Edit AI Category Settings</button>
                        </div>
                    </div>

                </div>

                <div class="modal-footer settings-footer">
                    <div class="settings-footer-left">
                        <button id="open-theme-btn" class="secondary-btn">üé® Theme</button>
                    </div>

                    <div class="settings-footer-right">
                        <div id="settings-save-status" class="save-status" aria-live="polite"></div>
                        <button id="save-settings-btn" class="primary-btn">Save Configuration</button>
                    </div>
                </div>
            </div>


            <!-- PAGE 3 ‚Äî AI CATEGORY SETTINGS -->
            <div id="ai-page">
                <div class="modal-body ai-cat-page-body">
                    <div class="page-header">
                        <h4>AI Category Settings</h4>
                        <span id="ai-unsaved-warning" class="inline-unsaved-warning" style="display: none;">‚ö† Unsaved changes</span>
                    </div>

                    <div class="ai-cat-body">

                        <div class="ai-col">
                            <div class="ai-cat-card">
                                <h5>Spaghetti</h5>
                                <label><input type="checkbox" id="cat_spaghetti_enabled"> Enabled</label>
                                <label><input type="checkbox" id="cat_spaghetti_trigger"> Can Trigger Failure</label>
                                <label>Detection Threshold (%):
                                    <input type="number" id="cat_spaghetti_detect_threshold" min="0" max="100">
                                </label>

                                <label>Trigger Threshold (%):
                                    <input type="number" id="cat_spaghetti_trigger_threshold" min="0" max="100">
                                </label>
                            </div>

                            <div class="ai-cat-card">
                                <h5>Blobs</h5>
                                <label><input type="checkbox" id="cat_blob_enabled"> Enabled</label>
                                <label><input type="checkbox" id="cat_blob_trigger"> Can Trigger Failure</label>
                                <label>Detection Threshold (%):
                                    <input type="number" id="cat_blob_detect_threshold" min="0" max="100">
                                </label>

                                <label>Trigger Threshold (%):
                                    <input type="number" id="cat_blob_trigger_threshold" min="0" max="100">
                                </label>
                            </div>
                        </div>

                        <div class="ai-col">
                            <div class="ai-cat-card">
                                <h5>Cracks</h5>
                                <label><input type="checkbox" id="cat_crack_enabled"> Enabled</label>
                                <label><input type="checkbox" id="cat_crack_trigger"> Can Trigger Failure</label>
                                <label>Detection Threshold (%):
                                    <input type="number" id="cat_crack_detect_threshold" min="0" max="100">
                                </label>

                                <label>Trigger Threshold (%):
                                    <input type="number" id="cat_crack_trigger_threshold" min="0" max="100">
                                </label>
                            </div>

                            <div class="ai-cat-card">
                                <h5>Warping</h5>
                                <label><input type="checkbox" id="cat_warping_enabled"> Enabled</label>
                                <label><input type="checkbox" id="cat_warping_trigger"> Can Trigger Failure</label>
                                <label>Detection Threshold (%):
                                    <input type="number" id="cat_warping_detect_threshold" min="0" max="100">
                                </label>

                                <label>Trigger Threshold (%):
                                    <input type="number" id="cat_warping_trigger_threshold" min="0" max="100">
                                </label>
                            </div>
                        </div>

                    </div>

                </div>

                <div class="modal-footer ai-footer">
                    <div class="ai-footer-left">
                        <button id="back-ai-btn" class="secondary-btn">Back</button>
                    </div>

                    <div class="ai-footer-right">
                        <div class="category-error-text" id="category-error-text"></div>
                        <div class="save-status" id="category-save-status" aria-live="polite"></div>
                        <button id="save-ai-cat-btn" class="primary-btn">Save Category Settings</button>
                    </div>
                </div>
            </div>

        </div>
        
    </dialog>

    <!-- THEME PREVIEW DOCK (DASHBOARD OVERLAY) -->
    <div id="theme-preview-dock" class="theme-preview-dock hidden">
        <div class="preview-dock-header">
            <span class="preview-title-line">Theme</span>
            <span class="preview-title-line">Preview</span>
        </div>

        <div class="preview-theme-list">
            <div class="preview-theme" data-theme="dark" title="Dark"></div>
            <div class="preview-theme" data-theme="light" title="Light"></div>
            <div class="preview-theme" data-theme="midnight" title="Midnight"></div>
            <div class="preview-theme" data-theme="crimson" title="Crimson"></div>
            <div class="preview-theme" data-theme="mint" title="Mint"></div>
            <div class="preview-theme" data-theme="forest" title="Forest"></div>
            <div class="preview-theme" data-theme="aurora" title="Aurora"></div>
            <div class="preview-theme" data-theme="voron" title="Voron"></div>
            <div class="preview-theme" data-theme="custom" title="Custom"></div>
        </div>
        
        <button id="exit-preview-btn" class="secondary-btn exit-preview-btn" type="button">Exit Preview</button>
        
    </div>
    
<!-- Per-category stats modal -->
    <dialog id="stats-modal" class="modal stats-modal">
        <div class="modal-header">
            <h3 id="stats-modal-title">Camera Detection Breakdown</h3>
            <button id="close-stats-modal" class="icon-btn">&times;</button>
        </div>
        <div class="modal-body">
            <div class="stats-table">
                <div class="stats-table-header">
                    <span>Category</span>
                    <span>Detections</span>
                    <span>Failures</span>
                </div>

                <div class="stats-table-row">
                    <span>Spaghetti</span>
                    <span id="stat-det-spaghetti">0</span>
                    <span id="stat-fail-spaghetti">0</span>
                </div>

                <div class="stats-table-row">
                    <span>Blobs</span>
                    <span id="stat-det-blob">0</span>
                    <span id="stat-fail-blob">0</span>
                </div>

                <div class="stats-table-row">
                    <span>Cracks</span>
                    <span id="stat-det-crack">0</span>
                    <span id="stat-fail-crack">0</span>
                </div>

                <div class="stats-table-row">
                    <span>Warping</span>
                    <span id="stat-det-warping">0</span>
                    <span id="stat-fail-warping">0</span>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="reset-stats-btn" class="secondary-btn">
                Reset Counters
            </button>
        </div>
    </dialog>
    
    <!-- Failure History modal -->
    <dialog id="history-modal" class="modal history-modal">
        <div class="modal-header">
            <h3>Failure History</h3>
            <button id="close-history-modal" class="icon-btn">&times;</button>
        </div>

        <div class="modal-body">
            <div class="history-table">
                <div id="history-scroll" class="history-scroll">
                    <div class="history-table-header">
                        <span>Time</span>
                        <span>Camera</span>
                        <span>Category</span>
                        <span>Conf</span>
                    </div>

                    <div id="history-table-body"></div>
                </div>
            </div>
        </div>

        <div class="modal-footer">
            <button id="clear-history-btn" class="secondary-btn">Clear History</button>
        </div>
    </dialog>
    
    <!-- Logs modal -->
    <dialog id="logs-modal" class="modal logs-modal">
        <div class="modal-header">
            <h3>Plugin Log</h3>
            <button id="close-logs-modal" class="icon-btn">&times;</button>
        </div>
        <div class="modal-body logs-body">
            <div id="log-content" class="log-content"></div>
        </div>
        <div class="modal-footer">
            <button id="download-logs-btn" class="primary-btn">Download</button>
        </div>
    </dialog>

    <!-- END BLOCK -->

    <script src="script.js"></script>
</body>
</html>